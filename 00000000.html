// Add this function right after the existing phase filter buttons creation in renderCRVerificationInCumulativeTable
function createStatusFilterButtons(buttonContainer) {
    // Create status filter container
    const statusButtonContainer = document.createElement('div');
    statusButtonContainer.className = 'mt-3 mb-3';
    
    // Create label for status filters
    const statusLabel = document.createElement('div');
    statusLabel.className = 'mb-2';
    statusLabel.textContent = 'Status Filters:';
    statusButtonContainer.appendChild(statusLabel);

    // Create button group for status filters
    const statusButtonGroup = document.createElement('div');
    statusButtonGroup.className = 'btn-group flex-wrap';
    statusButtonGroup.setAttribute('role', 'group');
    statusButtonGroup.setAttribute('aria-label', 'Status filters');

    // Define status options
    const statusOptions = [
        'All', 'Analysis', 'Closed', 'Fix', 'NotApplicable', 'Obsolete', 
        'Open', 'Ready', 'Reopen', 'Untested', 'Withdrawn', 'Built', 
        'Cannot Duplicate', 'NeedsRelease', 'Tested'
    ];

    // Keep track of selected statuses
    let selectedStatuses = new Set(['All']);

    // Create checkbox buttons for each status
    statusOptions.forEach(status => {
        const checkboxId = `status-${status.toLowerCase().replace(/\s+/g, '-')}`;
        
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.className = 'btn-check status-filter';
        checkbox.id = checkboxId;
        checkbox.value = status;
        checkbox.checked = status === 'All';

        const label = document.createElement('label');
        label.className = 'btn btn-outline-primary btn-sm m-1';
        label.setAttribute('for', checkboxId);
        label.textContent = status;

        // Add event listener for status filter change
        checkbox.addEventListener('change', (e) => {
            const clickedStatus = e.target.value;
            
            if (clickedStatus === 'All') {
                // If 'All' is selected, uncheck all other options
                if (e.target.checked) {
                    selectedStatuses.clear();
                    selectedStatuses.add('All');
                    statusButtonGroup.querySelectorAll('.status-filter').forEach(cb => {
                        cb.checked = cb.value === 'All';
                    });
                } else {
                    // Don't allow unchecking 'All' if it's the only option selected
                    e.target.checked = true;
                }
            } else {
                // If any other option is selected
                if (e.target.checked) {
                    // Remove 'All' from selection
                    selectedStatuses.delete('All');
                    statusButtonGroup.querySelector(`#status-all`).checked = false;
                    selectedStatuses.add(clickedStatus);
                } else {
                    selectedStatuses.delete(clickedStatus);
                    // If no other status is selected, select 'All'
                    if (selectedStatuses.size === 0) {
                        selectedStatuses.add('All');
                        statusButtonGroup.querySelector(`#status-all`).checked = true;
                    }
                }
            }

            // Get current phase and entries per page
            const selectedPhase = document.querySelector('.phase-filter.active').getAttribute('data-phase');
            const entriesPerPage = parseInt(document.querySelector('.form-select').value);
            
            // Rerender table with filtered data
            renderFilteredCRVerificationTable(
                tableData, 
                columnNames, 
                document.getElementById('reportContentContainer'),
                selectedPhase,
                entriesPerPage,
                1,
                Array.from(selectedStatuses)
            );
        });

        statusButtonGroup.appendChild(checkbox);
        statusButtonGroup.appendChild(label);
    });

    // Add styles for status filter buttons
    const styleElement = document.createElement('style');
    styleElement.textContent = `
        .status-filter + label {
            font-size: 0.875rem;
            padding: 0.25rem 0.5rem;
        }
        .btn-group.flex-wrap {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
        }
    `;
    document.head.appendChild(styleElement);

    statusButtonContainer.appendChild(statusButtonGroup);
    buttonContainer.appendChild(statusButtonContainer);
}

// Modify the getFilteredData function to include status filtering
function getFilteredData(tableData, selectedPhase, selectedTeam, selectedStatuses = ['All']) {
    const filteredData = [];
    if (tableData[selectedTeam]) {
        for (const phase in tableData[selectedTeam]) {
            if (selectedPhase === 'all' || phase === selectedPhase) {
                const phaseData = tableData[selectedTeam][phase];
                if (selectedStatuses.includes('All')) {
                    filteredData.push(...phaseData);
                } else {
                    const statusFilteredData = phaseData.filter(row => 
                        selectedStatuses.includes(row.Status)
                    );
                    filteredData.push(...statusFilteredData);
                }
            }
        }
    }
    return filteredData;
}

// Modify renderFilteredCRVerificationTable to accept selectedStatuses parameter
function renderFilteredCRVerificationTable(tableData, columnNames, targetElement, selectedPhase, entriesPerPage, currentPage, selectedStatuses = ['All']) {
    // ... (keep existing code at the beginning)

    // Update the filtered data call to include status filtering
    const filteredData = getFilteredData(tableData, selectedPhase, selectedTeam, selectedStatuses);

    // ... (rest of the existing function remains the same)
}
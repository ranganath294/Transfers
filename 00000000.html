function renderSPReportInCumulativeTable(coverageSummaryData, contentContainer) {
    // Create a single card structure for SP Report view
    const spReportCardElement = document.createElement('div');
    spReportCardElement.className = 'card mb-3';

    // Create card body
    const spReportCardBody = document.createElement('div');
    spReportCardBody.className = 'card-body';
    
    // Create phase filter container for SP Report view with flexbox layout
    const phaseFilterContainer = document.createElement('div');
    phaseFilterContainer.className = 'mb-3 d-flex flex-column flex-sm-row justify-content-between align-items-start align-items-sm-center gap-2';

    // Create button group for phase filters with 4px gap
    const spReportPhaseButtonGroup = document.createElement('div');
    spReportPhaseButtonGroup.className = 'btn-group flex-shrink-0';
    spReportPhaseButtonGroup.setAttribute('role', 'group');
    spReportPhaseButtonGroup.setAttribute('aria-label', 'Phase filters');
    spReportPhaseButtonGroup.style.gap = '4px'; // Add 4px gap between buttons
    
    // Create phase filter buttons
    const phases = ['ES', 'FC', 'CS'];
    phases.forEach(phase => {
        const button = document.createElement('button');
        button.type = 'button';
        button.className = `btn btn-outline-primary sp-report-phase-filter ${phase === 'ES' ? 'active' : ''}`;
        button.setAttribute('data-phase', phase);
        button.textContent = phase;
        spReportPhaseButtonGroup.appendChild(button);
    });
    
    // Create downloads dropdown container
    const downloadsContainer = document.createElement('div');
    downloadsContainer.className = 'dropdown downloads-dropdown flex-shrink-0';
    
    // Create downloads dropdown button
    const downloadsButton = document.createElement('button');
    downloadsButton.className = 'btn btn-primary dropdown-toggle';
    downloadsButton.type = 'button';
    downloadsButton.id = 'downloadDropdown';
    downloadsButton.setAttribute('data-bs-toggle', 'dropdown');
    downloadsButton.setAttribute('aria-expanded', 'false');
    downloadsButton.textContent = 'Downloads';
    
    // Create dropdown menu
    const dropdownMenu = document.createElement('ul');
    dropdownMenu.className = 'dropdown-menu';
    dropdownMenu.setAttribute('aria-labelledby', 'downloadDropdown');
    
    // Create dropdown items with initial text
    const dropdownItems = [
        { id: 'exportCoverageReport', text: 'Daily Coverage Report XL', downloadType: 'coverage_report' },
        { id: 'exportScrumSheet', text: 'Export Scrum Sheet to XL', downloadType: 'scrum_sheet' },
        { id: 'downloadSPReport', text: 'Download SP Report', downloadType: 'sp_report' }
    ];
    
    dropdownItems.forEach(item => {
        const listItem = document.createElement('li');
        const link = document.createElement('a');
        link.className = 'dropdown-item';
        link.href = '#';
        link.id = item.id;
        link.textContent = item.text;
        link.setAttribute('data-download-type', item.downloadType);
        listItem.appendChild(link);
        dropdownMenu.appendChild(listItem);
    });
    
    // Append button and menu to dropdown container
    downloadsContainer.appendChild(downloadsButton);
    downloadsContainer.appendChild(dropdownMenu);
    
    // Create SP Report content container
    const spReportContentContainer = document.createElement('div');
    spReportContentContainer.id = 'spReportContentContainer';
    spReportContentContainer.className = 'mt-3'; // Add margin top for spacing
    
    // Append elements to the phase filter container
    phaseFilterContainer.appendChild(spReportPhaseButtonGroup);
    phaseFilterContainer.appendChild(downloadsContainer);
    
    // Append elements to the card
    spReportCardBody.appendChild(phaseFilterContainer);
    spReportCardBody.appendChild(spReportContentContainer);
    spReportCardElement.appendChild(spReportCardBody);
    
    // Append card to the main content container
    contentContainer.appendChild(spReportCardElement);
    
    // Function to update dropdown button text based on current selections
    function updateDownloadDropdownText() {
        try {
            const spSelect = document.getElementById('sp_name');
            const selectedSp = spSelect ? spSelect.value : '';
            const selectedTeamElement = document.querySelector('input[name="team-filter"]:checked');
            const selectedTeam = selectedTeamElement ? selectedTeamElement.value : '';
            const selectedPhaseButton = document.querySelector('.sp-report-phase-filter.active');
            const selectedPhase = selectedPhaseButton ? selectedPhaseButton.getAttribute('data-phase') : 'ES';

            // Update dropdown item texts
            const exportCoverageReportLink = document.getElementById('exportCoverageReport');
            const exportScrumSheetLink = document.getElementById('exportScrumSheet');
            const downloadSPReportLink = document.getElementById('downloadSPReport');

            if (exportCoverageReportLink) {
                exportCoverageReportLink.textContent = `${selectedSp} ${selectedTeam} ${selectedPhase} Daily Coverage Report`;
            }
            if (exportScrumSheetLink) {
                exportScrumSheetLink.textContent = `${selectedSp} ${selectedTeam} ${selectedPhase} Daily Scrum CRs`;
            }
            if (downloadSPReportLink) {
                downloadSPReportLink.textContent = `${selectedSp} ${selectedTeam} ${selectedPhase} Report PPT`;
            }
        } catch (error) {
            console.error('Error updating download dropdown text:', error);
        }
    }
    
    // Add event listeners for phase filter buttons
    spReportPhaseButtonGroup.addEventListener('click', async (e) => {
        if (e.target.classList.contains('sp-report-phase-filter')) {
            // Remove active class from all buttons
            spReportPhaseButtonGroup.querySelectorAll('.sp-report-phase-filter').forEach(btn => btn.classList.remove('active'));
            // Add active class to the clicked button
            e.target.classList.add('active');
            // Get the selected phase
            const selectedPhase = e.target.getAttribute('data-phase');
            
            // Clear the SP Report content container
            spReportContentContainer.innerHTML = '';
            
            // Update dropdown text when phase changes
            updateDownloadDropdownText();
            
            // Render the table and graph with the selected phase
            await renderSPReportTableAndGraph(selectedPhase, spReportContentContainer);
        }
    });

    // Add event listeners for download buttons
    dropdownMenu.addEventListener('click', (e) => {
        e.preventDefault();
        const target = e.target;
        
        if (target.classList.contains('dropdown-item')) {
            const downloadType = target.getAttribute('data-download-type');
            if (downloadType && typeof downloadReport === 'function') {
                downloadReport(downloadType);
            } else {
                console.error('downloadReport function not found or download type not specified');
            }
        }
    });
    
    // Add listeners for SP selection and team filter changes if they exist
    const spSelect = document.getElementById('sp_name');
    if (spSelect) {
        spSelect.addEventListener('change', updateDownloadDropdownText);
    }
    
    // Add listeners for team filter changes
    const teamFilters = document.querySelectorAll('input[name="team-filter"]');
    teamFilters.forEach(filter => {
        filter.addEventListener('change', updateDownloadDropdownText);
    });
    
    updateDownloadDropdownText();

    // Initial render of SP Report with default 'ES' phase
    renderSPReportTableAndGraph('ES', spReportContentContainer);
}

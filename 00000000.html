def add_combined_coverage_slide(prs, coverage_summary_data, selected_sp, selected_teams=None, selected_phases=None):
    for sp in coverage_summary_data:
        sp_name = sp['sp_name']
        teams = sp['teams']

        for team in teams:
            if selected_teams is None or team['team_name'] in selected_teams:
                team_name = team['team_name']

                for phase in team['phases']:
                    if selected_phases is None or phase['phase'] in selected_phases:
                        phase_name = phase['phase']

                        # Prepare main coverage report data
                        phase_data, phase_merge_info = prepare_table_data([{'team_name': team_name, 'phases': [phase]}])
                        if not phase_data:
                            continue

                        # Add slide
                        slide = prs.slides.add_slide(prs.slide_layouts[5])
                        slide.shapes.title.text = f"{sp_name} {team_name} {phase_name}"

                        # Main coverage report table on top
                        add_general_table_to_slide(
                            slide, phase_data, Inches(0.0), Inches(1.5), Inches(11.6), Inches(0.4 * len(phase_data))
                        )

                        # Bottom half tables (side-by-side)
                        # Fixed space assignment (regardless of number of rows)
                        test_group_percentages = calculate_test_group_percentages_data(selected_sp, team_name, phase_name, coverage_summary_data)
                        if test_group_percentages:
                            test_group_table_data = [['Test Group', 'Test Group Percentage']] + [
                                [tg['test_group'], format_percentage(tg['test_group_percentage'])] for tg in test_group_percentages
                            ]
                            add_general_table_to_slide(
                                slide, test_group_table_data,
                                left=Inches(0.3), top=Inches(1.5 + 0.4 * len(phase_data) + 0.5),
                                width=Inches(5.5), height=Inches(3.0)
                            )

                        subsystem_percentages = calculate_subsystem_percentages_data(selected_sp, team_name, phase_name, coverage_summary_data)
                        if subsystem_percentages:
                            subsystem_table_data = [['Subsystem', 'Subsystem Percentage']] + [
                                [tg['subsystem'], format_percentage(tg['subsystemPercentage'])] for tg in subsystem_percentages
                            ]
                            add_general_table_to_slide(
                                slide, subsystem_table_data,
                                left=Inches(6.0), top=Inches(1.5 + 0.4 * len(phase_data) + 0.5),
                                width=Inches(5.5), height=Inches(3.0)
                            )

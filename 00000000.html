// Modify the renderFilteredCRVerificationTable function to properly handle pagination
function renderFilteredCRVerificationTable(tableData, columnNames, targetElement, selectedPhase, entriesPerPage, currentPage) {
    // Clear existing table if any
    targetElement.querySelector('table')?.remove();

    // Create table element
    const table = document.createElement('table');
    table.className = 'coverage-table';

    // Create header
    const thead = document.createElement('thead');
    const headerRow = document.createElement('tr');
    columnNames.forEach(header => {
        const th = document.createElement('th');
        th.textContent = header;
        headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);
    table.appendChild(thead);

    // Get the selected team from the team filter
    const selectedTeam = document.querySelector('input[name="team-filter"]:checked').value;

    // Filter data based on the selected team and phase
    const filteredData = getFilteredData(tableData, selectedPhase, selectedTeam);

    // Calculate pagination details
    const totalPages = Math.ceil(filteredData.length / entriesPerPage);
    const startIndex = (currentPage - 1) * entriesPerPage;
    const endIndex = Math.min(startIndex + entriesPerPage, filteredData.length);
    const paginatedData = filteredData.slice(startIndex, endIndex);

    // Create table body
    const tbody = document.createElement('tbody');
    paginatedData.forEach(rowData => {
        const tr = document.createElement('tr');
        columnNames.forEach(columnName => {
            const td = document.createElement('td');
            td.textContent = rowData[columnName] !== null ? rowData[columnName] : '';
            tr.appendChild(td);
        });
        tbody.appendChild(tr);
    });
    table.appendChild(tbody);
    targetElement.appendChild(table);

    // Update pagination controls
    updatePaginationControls(startIndex, endIndex, filteredData.length, currentPage, totalPages);

    // Adjust column widths
    adjustColumnWidths();
}

// Add a new function to update pagination controls
function updatePaginationControls(startIndex, endIndex, totalEntries, currentPage, totalPages) {
    const entriesInfo = document.querySelector('.entries-info');
    const pageNumbers = document.querySelector('.page-numbers');
    const prevButton = document.querySelector('.prev-page');
    const nextButton = document.querySelector('.next-page');

    // Update entries info
    entriesInfo.textContent = `Showing ${startIndex + 1} to ${endIndex} of ${totalEntries} entries`;

    // Clear existing page numbers
    pageNumbers.innerHTML = '';

    // Add page number buttons
    if (totalPages > 0) {
        // Calculate range of pages to show
        let startPage = Math.max(1, currentPage - 2);
        let endPage = Math.min(totalPages, startPage + 4);
        
        // Adjust start page if we're near the end
        if (endPage - startPage < 4) {
            startPage = Math.max(1, endPage - 4);
        }

        // Add first page if not included in range
        if (startPage > 1) {
            addPageButton(pageNumbers, 1, currentPage);
            if (startPage > 2) pageNumbers.appendChild(createEllipsis());
        }

        // Add page numbers
        for (let i = startPage; i <= endPage; i++) {
            addPageButton(pageNumbers, i, currentPage);
        }

        // Add last page if not included in range
        if (endPage < totalPages) {
            if (endPage < totalPages - 1) pageNumbers.appendChild(createEllipsis());
            addPageButton(pageNumbers, totalPages, currentPage);
        }
    }

    // Update button states
    prevButton.disabled = currentPage <= 1;
    nextButton.disabled = currentPage >= totalPages;

    // Store current page and total pages as data attributes
    pageNumbers.setAttribute('data-current-page', currentPage);
    pageNumbers.setAttribute('data-total-pages', totalPages);
}

// Helper function to create page number button
function addPageButton(container, pageNum, currentPage) {
    const pageButton = document.createElement('button');
    pageButton.className = `page-link ${pageNum === currentPage ? 'active' : ''}`;
    pageButton.textContent = pageNum;
    pageButton.addEventListener('click', () => {
        const selectedPhase = document.querySelector('.phase-filter.active').getAttribute('data-phase');
        const entriesPerPage = parseInt(document.querySelector('.form-select').value);
        renderFilteredCRVerificationTable(
            window.crVerificationData, 
            window.crVerificationColumnNames, 
            document.getElementById('reportContentContainer'),
            selectedPhase,
            entriesPerPage,
            pageNum
        );
    });
    container.appendChild(pageButton);
}

// Helper function to create ellipsis
function createEllipsis() {
    const ellipsis = document.createElement('span');
    ellipsis.className = 'page-link disabled';
    ellipsis.textContent = '...';
    return ellipsis;
}

// Update the event listeners for next and previous buttons
document.addEventListener('DOMContentLoaded', function() {
    // ... (existing code) ...

    // Update next button click handler
    nextButton.addEventListener('click', () => {
        const pageNumbers = document.querySelector('.page-numbers');
        const currentPage = parseInt(pageNumbers.getAttribute('data-current-page'));
        const totalPages = parseInt(pageNumbers.getAttribute('data-total-pages'));
        
        if (currentPage < totalPages) {
            const selectedPhase = document.querySelector('.phase-filter.active').getAttribute('data-phase');
            const entriesPerPage = parseInt(document.querySelector('.form-select').value);
            renderFilteredCRVerificationTable(
                window.crVerificationData,
                window.crVerificationColumnNames,
                document.getElementById('reportContentContainer'),
                selectedPhase,
                entriesPerPage,
                currentPage + 1
            );
        }
    });

    // Update previous button click handler
    prevButton.addEventListener('click', () => {
        const pageNumbers = document.querySelector('.page-numbers');
        const currentPage = parseInt(pageNumbers.getAttribute('data-current-page'));
        
        if (currentPage > 1) {
            const selectedPhase = document.querySelector('.phase-filter.active').getAttribute('data-phase');
            const entriesPerPage = parseInt(document.querySelector('.form-select').value);
            renderFilteredCRVerificationTable(
                window.crVerificationData,
                window.crVerificationColumnNames,
                document.getElementById('reportContentContainer'),
                selectedPhase,
                entriesPerPage,
                currentPage - 1
            );
        }
    });
});
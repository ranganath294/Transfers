sp_list = request.GET.getlist('sp_name')
counts_df = pd.DataFrame()

counts_df_dict = {}

for selected_sp in sp_list:
    counts_df = process_sp(selected_sp)
    counts_df = counts_df.set_index('Test Team').T.reset_index().rename(columns={'index': 'Metrics'})
    counts_df = counts_df.fillna(0)  # Replace NaN with 0 or another appropriate value
    # counts_df_dict[selected_sp] = counts_df.to_dict(orient='records')
    
    for _, row in counts_df.iterrows():
        metric = row['Metrics']
        if metric not in counts_df_dict:
            counts_df_dict[metric] = {}
        counts_df_dict[metric][selected_sp] = {
            'BT': row.get('BT', 0),
            'WLAN': row.get('WLAN', 0)
        }

document.getElementById('downloadButton').addEventListener('click', function() {
        const spSelect = document.getElementById('sp_name');
        const selectedSp = spSelect.value;
        if (!selectedSp) {
            addAlert('danger', 'Please select an SP first')
            // alert('Please select an SP first');
            return;
        }
        const params = new URLSearchParams();
        params.append('sp_name', selectedSp);

        fetch(`{% url 'cst_reporting_views:download_excel' %}?${params.toString()}`)
            .then(response => {
                if (!response.ok) {
                    return response.json().then(data => {
                        throw new Error(data.error_msg);
                    });
                }
                return response.blob();
            })
            .then(blob => {
                console.log("Blob type:", blob.type);
                console.log("Blob size:", blob.size);
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = `${selectedSp}_coverage_report.xlsx`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                addAlert('success', 'File downloaded successfully!');
            })
            .catch(error => {
                addAlert('danger', `Error: ${error.message}`);
                document.getElementById('statusMessage').textContent = 'Error: ' + error.message;
            });
    });

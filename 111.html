class ConfigInputHandler {
    constructor(containerSelector) {
        this.container = document.querySelector(containerSelector);
        this.inputTypes = {
            STRING: 'string',
            ARRAY: 'array',
            OBJECT: 'object',
            BOOLEAN: 'boolean',
            NUMBER: 'number'
        };
    }

    // Create type selector with proper array handling
    createTypeSelector(initialType, innerType = 'string') {
        const select = document.createElement('select');
        select.className = 'form-select mb-2';

        // Add all basic types
        Object.values(this.inputTypes).forEach(type => {
            const option = document.createElement('option');
            option.value = type;
            option.textContent = type.charAt(0).toUpperCase() + type.slice(1);
            if (type === initialType) option.selected = true;
            select.appendChild(option);
        });

        select.addEventListener('change', (e) => {
            const newType = e.target.value;
            
            // Remove existing input and any unwanted dropdowns
            if (currentInputElement) {
                container.removeChild(currentInputElement);
            }

            // Create new input based on selected type
            currentInputType = newType;
            currentInputElement = this.createInputBasedOnType(newType, defaultValue, innerType);
            container.appendChild(currentInputElement);
        });

        return select;
    }

    // Updated detectInputType to handle arrays properly
    detectInputType(defaultValue) {
        if (defaultValue === null) return this.inputTypes.STRING;
        
        if (Array.isArray(defaultValue)) {
            return this.inputTypes.ARRAY;
        }
        
        if (typeof defaultValue === 'object') return this.inputTypes.OBJECT;
        if (typeof defaultValue === 'boolean') return this.inputTypes.BOOLEAN;
        if (typeof defaultValue === 'number') return this.inputTypes.NUMBER;
        
        return this.inputTypes.STRING;
    }

    // Helper method to detect inner type of array
    detectArrayInnerType(array) {
        if (!array || array.length === 0) return 'string'; // default
        
        const firstItem = array[0];
        if (typeof firstItem === 'number') return 'number';
        if (typeof firstItem === 'boolean') return 'boolean';
        if (typeof firstItem === 'object') return 'object';
        return 'string';
    }

    createInputBasedOnType(type, defaultValue, innerType = null) {
        const onChangeCallback = (value) => {
            console.log('Value changed:', value);
        };

        if (type === this.inputTypes.ARRAY) {
            // If innerType not provided, detect it from defaultValue
            const actualInnerType = innerType || this.detectArrayInnerType(defaultValue);
            return this.createArrayInput(defaultValue, onChangeCallback, actualInnerType);
        }

        switch(type) {
            case this.inputTypes.STRING:
                return this.createStringInput(defaultValue, onChangeCallback);
            case this.inputTypes.OBJECT:
                return this.createObjectInput(defaultValue, onChangeCallback);
            case this.inputTypes.BOOLEAN:
                return this.createBooleanInput(defaultValue, onChangeCallback);
            case this.inputTypes.NUMBER:
                return this.createNumberInput(defaultValue, onChangeCallback);
            default:
                return this.createStringInput(defaultValue, onChangeCallback);
        }
    }

    createArrayInput(defaultValue, onChangeCallback, itemType = 'string') {
        const container = document.createElement('div');
        container.className = 'array-input-container';

        const arrayValues = Array.isArray(defaultValue) ? [...defaultValue] : [];

        const renderArrayItems = () => {
            container.innerHTML = '';
            
            arrayValues.forEach((value, index) => {
                const itemWrapper = document.createElement('div');
                itemWrapper.className = 'input-group mb-2';

                // Create appropriate input based on itemType
                let itemInput;
                switch(itemType) {
                    case 'number':
                        itemInput = this.createNumberInput(value, (newValue) => {
                            arrayValues[index] = newValue;
                            onChangeCallback(arrayValues);
                        });
                        break;
                    case 'boolean':
                        itemInput = this.createBooleanInput(value, (newValue) => {
                            arrayValues[index] = newValue;
                            onChangeCallback(arrayValues);
                        });
                        break;
                    case 'object':
                        itemInput = this.createObjectInput(value, (newValue) => {
                            arrayValues[index] = newValue;
                            onChangeCallback(arrayValues);
                        });
                        break;
                    default: // string
                        itemInput = this.createStringInput(value, (newValue) => {
                            arrayValues[index] = newValue;
                            onChangeCallback(arrayValues);
                        });
                }

                // Move buttons
                const moveUpBtn = document.createElement('button');
                moveUpBtn.className = 'btn btn-outline-secondary';
                moveUpBtn.innerHTML = '↑';
                moveUpBtn.disabled = index === 0;
                moveUpBtn.addEventListener('click', () => {
                    [arrayValues[index], arrayValues[index-1]] = [arrayValues[index-1], arrayValues[index]];
                    renderArrayItems();
                    onChangeCallback(arrayValues);
                });

                const moveDownBtn = document.createElement('button');
                moveDownBtn.className = 'btn btn-outline-secondary';
                moveDownBtn.innerHTML = '↓';
                moveDownBtn.disabled = index === arrayValues.length - 1;
                moveDownBtn.addEventListener('click', () => {
                    [arrayValues[index], arrayValues[index+1]] = [arrayValues[index+1], arrayValues[index]];
                    renderArrayItems();
                    onChangeCallback(arrayValues);
                });

                // Remove button
                const removeBtn = document.createElement('button');
                removeBtn.className = 'btn btn-danger ms-2';
                removeBtn.innerHTML = '×';
                removeBtn.addEventListener('click', () => {
                    arrayValues.splice(index, 1);
                    renderArrayItems();
                    onChangeCallback(arrayValues);
                });

                itemWrapper.appendChild(moveUpBtn);
                itemWrapper.appendChild(moveDownBtn);
                itemWrapper.appendChild(itemInput);
                itemWrapper.appendChild(removeBtn);
                container.appendChild(itemWrapper);
            });

            // Add new item button
            const addBtn = document.createElement('button');
            addBtn.className = 'btn btn-primary mt-2';
            addBtn.textContent = 'Add Item';
            addBtn.addEventListener('click', () => {
                // Add appropriate default value based on type
                let defaultVal;
                switch(itemType) {
                    case 'number': defaultVal = 0; break;
                    case 'boolean': defaultVal = false; break;
                    case 'object': defaultVal = {}; break;
                    default: defaultVal = ''; break;
                }
                arrayValues.push(defaultVal);
                renderArrayItems();
                onChangeCallback(arrayValues);
            });

            container.appendChild(addBtn);
        };

        renderArrayItems();
        return container;
    }

    // Rest of the methods remain the same...
}
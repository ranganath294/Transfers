// Enhanced array input to handle nested arrays with type selection
createNestedArrayInput(defaultValue, onChangeCallback, depth, itemType = null) {
    const container = document.createElement('div');
    container.className = 'nested-array-container';

    const arrayValues = Array.isArray(defaultValue) ? [...defaultValue] : [];

    const renderArrayItems = () => {
        container.innerHTML = '';
        
        arrayValues.forEach((value, index) => {
            const itemWrapper = document.createElement('div');
            itemWrapper.className = 'nested-array-item input-group mb-2';

            // Detect or use provided item type
            const detectedItemType = itemType || this.detectItemType(value);
            let currentItemType = detectedItemType === 'primitive' 
                ? this.detectInputType(value) 
                : detectedItemType;

            // Type selector for array elements
            const typeSelector = this.createInputTypeSelector(currentItemType, (newType) => {
                // Reset the value based on the new type
                switch(newType) {
                    case this.inputTypes.STRING:
                        arrayValues[index] = '';
                        break;
                    case this.inputTypes.NUMBER:
                        arrayValues[index] = 0;
                        break;
                    case this.inputTypes.BOOLEAN:
                        arrayValues[index] = false;
                        break;
                    case this.inputTypes.ARRAY:
                        arrayValues[index] = [];
                        break;
                    case this.inputTypes.OBJECT:
                        arrayValues[index] = {};
                        break;
                }
                
                // Update type and re-render items
                currentItemType = newType;
                renderArrayItems();
                onChangeCallback(arrayValues);
            });

            // Input based on detected/selected type
            const itemInput = this.createInputBasedOnType(
                currentItemType, 
                value, 
                depth + 1
            );

            // Update value handling
            itemInput.addEventListener('change', (e) => {
                arrayValues[index] = e.target.value;
                onChangeCallback(arrayValues);
            });

            // Remove button
            const removeBtn = document.createElement('button');
            removeBtn.className = 'btn btn-danger ms-2';
            removeBtn.innerHTML = '&times;';
            removeBtn.addEventListener('click', () => {
                arrayValues.splice(index, 1);
                renderArrayItems();
                onChangeCallback(arrayValues);
            });

            // Assemble item wrapper
            itemWrapper.appendChild(typeSelector);
            itemWrapper.appendChild(itemInput);
            itemWrapper.appendChild(removeBtn);

            container.appendChild(itemWrapper);
        });

        // Add new item button
        const addBtn = document.createElement('button');
        addBtn.className = 'btn btn-primary mt-2';
        addBtn.textContent = 'Add Item';
        addBtn.addEventListener('click', () => {
            arrayValues.push(''); // Default to empty string
            renderArrayItems();
            onChangeCallback(arrayValues);
        });

        container.appendChild(addBtn);
    };

    renderArrayItems();
    return container;
}
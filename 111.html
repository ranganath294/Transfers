function validateInput(input) {
    const value = input.value.trim();
    const datatype = input.dataset.datatype;
    
    // Ensure validation message element exists
    let messageElement = document.getElementById(`${input.name}-validation`);
    if (!messageElement) {
        messageElement = document.createElement('div');
        messageElement.className = 'invalid-feedback';
        messageElement.id = `${input.name}-validation`;
        input.parentNode.insertBefore(messageElement, input.nextSibling);
    }

    // First check if input is required
    const isRequired = input.hasAttribute('required');
    
    // Handle empty values
    if (!value) {
        if (isRequired) {
            input.classList.add('is-invalid');
            input.classList.remove('is-valid');
            messageElement.textContent = 'This field is required. Use "" for empty value.';
            messageElement.style.display = 'block';
            return false;
        } else {
            input.classList.remove('is-invalid');
            input.classList.add('is-valid');
            messageElement.style.display = 'none';
            return true;
        }
    }

    // Handle explicit empty string case (""), treating it as a valid empty value
    if (value === '""') {
        input.classList.remove('is-invalid');
        input.classList.add('is-valid');
        messageElement.style.display = 'none';
        return true;
    }

    try {
        switch (datatype) {
            case 'str':
                // Allow empty string but not other quoted strings
                if (value !== '""' && (value.includes('"') || value.includes("'"))) {
                    throw new Error('String should not contain quotes unless using "" for empty string');
                }
                break;
                
            case 'list':
                // Allow empty list or comma-separated values
                if (value !== '""' && (value.includes('"') || value.includes("'") || value.includes('[') || value.includes(']'))) {
                    throw new Error('Use comma-separated values without quotes/brackets, or "" for empty list');
                }
                break;
                
            case 'dict':
                // Allow empty object or valid JSON
                if (value === '""') {
                    throw new Error('Use {} for empty object, not ""');
                }
                try {
                    JSON.parse(value);
                } catch (e) {
                    throw new Error('Invalid JSON format. Use proper JSON object format or {}');
                }
                break;
                
            case 'bool':
                if (!['true', 'false'].includes(value.toLowerCase())) {
                    throw new Error('Value must be true or false');
                }
                break;
                
            case 'int':
                if (value !== '""' && !Number.isInteger(Number(value))) {
                    throw new Error('Value must be a whole number, or "" for null');
                }
                break;
                
            case 'float':
                if (value !== '""' && isNaN(Number(value))) {
                    throw new Error('Value must be a number, or "" for null');
                }
                break;
                
            default:
                // For unknown datatypes, accept any non-empty value
                break;
        }
        
        // If we get here, validation passed
        input.classList.remove('is-invalid');
        input.classList.add('is-valid');
        messageElement.style.display = 'none';
        return true;
        
    } catch (error) {
        input.classList.remove('is-valid');
        input.classList.add('is-invalid');
        messageElement.textContent = error.message;
        messageElement.style.display = 'block';
        return false;
    }
}
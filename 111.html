// Function to validate input based on datatype
function validateInput(input) {
    const value = input.value.trim();
    const datatype = input.dataset.datatype;
    const validationMessage = document.getElementById(`${input.name}-validation`);

    try {
        switch (datatype) {
            case 'str':
                // Allow empty string but not quotes
                if (value.includes('"') || value.includes("'")) {
                    throw new Error('String should not contain quotes');
                }
                break;
                
            case 'list':
                // Allow empty string or valid comma-separated values
                if (value && (value.includes('"') || value.includes("'") || value.includes('[') || value.includes(']'))) {
                    throw new Error('Enter comma-separated values without quotes or brackets');
                }
                break;
                
            case 'dict':
                // Allow empty string or valid JSON
                if (value) {
                    JSON.parse(value);
                }
                break;
                
            case 'bool':
                if (!['true', 'false'].includes(value.toLowerCase())) {
                    throw new Error('Value must be true or false');
                }
                break;
                
            case 'int':
                // Allow empty string or valid integer
                if (value && !Number.isInteger(Number(value))) {
                    throw new Error('Value must be a whole number');
                }
                break;
                
            case 'float':
                // Allow empty string or valid number
                if (value && isNaN(Number(value))) {
                    throw new Error('Value must be a number');
                }
                break;
        }
        
        input.classList.remove('is-invalid');
        input.classList.add('is-valid');
        validationMessage.style.display = 'none';
        return true;
    } catch (error) {
        input.classList.remove('is-valid');
        input.classList.add('is-invalid');
        validationMessage.textContent = error.message;
        validationMessage.style.display = 'block';
        return false;
    }
}

// Function to get datatype rules
function getDataTypeRules(datatype) {
    const rules = {
        'str': 'Enter text without quotes, or leave empty for empty string',
        'list': 'Enter comma-separated values without quotes or brackets, or leave empty for empty list',
        'dict': 'Enter a valid JSON object, or leave empty for empty object',
        'bool': 'Enter true or false',
        'int': 'Enter a whole number, or leave empty for null',
        'float': 'Enter a decimal number, or leave empty for null'
    };
    return `Rules: ${rules[datatype] || 'Enter a valid value'}`;
}

// Function to parse value based on datatype
function parseValue(value, datatype) {
    const trimmedValue = value.trim();
    
    // Handle intentionally empty values
    if (trimmedValue === '') {
        switch (datatype) {
            case 'list':
                return [];
            case 'dict':
                return {};
            case 'int':
            case 'float':
                return null;
            case 'str':
                return '';
            case 'bool':
                return false;
            default:
                return trimmedValue;
        }
    }

    // Parse non-empty values
    switch (datatype) {
        case 'list':
            return trimmedValue; // Return as is since it's already comma-separated
        case 'dict':
            return JSON.parse(trimmedValue);
        case 'bool':
            return trimmedValue.toLowerCase() === 'true';
        case 'int':
            return parseInt(trimmedValue);
        case 'float':
            return parseFloat(trimmedValue);
        default:
            return trimmedValue;
    }
}
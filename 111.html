// Function to validate input based on datatype
function validateInput(input) {
    const value = input.value.trim();
    const datatype = input.dataset.datatype;
    const validationMessage = document.getElementById(`${input.name}-validation`);

    // Check for intentionally empty value with quotes
    if (value === '""') {
        input.classList.remove('is-invalid');
        input.classList.add('is-valid');
        validationMessage.style.display = 'none';
        return true;
    }

    // Check if field is empty (not intentionally empty)
    if (!value) {
        input.classList.add('is-invalid');
        input.classList.remove('is-valid');
        validationMessage.textContent = 'This field is required. Use "" for empty value.';
        validationMessage.style.display = 'block';
        return false;
    }

    try {
        switch (datatype) {
            case 'str':
                if (value.includes('"') || value.includes("'")) {
                    throw new Error('Quotes are only allowed as "" to indicate empty value');
                }
                break;
                
            case 'list':
                if (value.includes('"') || value.includes("'") || value.includes('[') || value.includes(']')) {
                    throw new Error('Use comma-separated values without quotes/brackets, or "" for empty list');
                }
                break;
                
            case 'dict':
                if (value.includes('""')) {
                    throw new Error('Use {} for empty object, not ""');
                }
                JSON.parse(value);
                break;
                
            case 'bool':
                if (!['true', 'false'].includes(value.toLowerCase())) {
                    throw new Error('Value must be true or false');
                }
                break;
                
            case 'int':
                if (!Number.isInteger(Number(value))) {
                    throw new Error('Value must be a whole number, or "" for null');
                }
                break;
                
            case 'float':
                if (isNaN(Number(value))) {
                    throw new Error('Value must be a number, or "" for null');
                }
                break;
        }
        
        input.classList.remove('is-invalid');
        input.classList.add('is-valid');
        validationMessage.style.display = 'none';
        return true;
    } catch (error) {
        input.classList.remove('is-valid');
        input.classList.add('is-invalid');
        validationMessage.textContent = error.message;
        validationMessage.style.display = 'block';
        return false;
    }
}

// Function to get datatype rules
function getDataTypeRules(datatype) {
    const rules = {
        'str': 'Enter text without quotes, or use "" for empty string',
        'list': 'Enter comma-separated values without quotes/brackets, or use "" for empty list',
        'dict': 'Enter a valid JSON object, use {} for empty object',
        'bool': 'Enter true or false',
        'int': 'Enter a whole number, or use "" for null',
        'float': 'Enter a decimal number, or use "" for null'
    };
    return `Rules: ${rules[datatype] || 'Enter a valid value'}`;
}

// Function to parse value based on datatype
function parseValue(value, datatype) {
    const trimmedValue = value.trim();
    
    // Handle intentionally empty values marked with ""
    if (trimmedValue === '""') {
        switch (datatype) {
            case 'list':
                return [];
            case 'dict':
                return {};
            case 'int':
            case 'float':
                return null;
            case 'str':
                return '';
            default:
                return '';
        }
    }

    // Parse non-empty values
    switch (datatype) {
        case 'list':
            return trimmedValue === '' ? [] : trimmedValue;
        case 'dict':
            return trimmedValue === '{}' ? {} : JSON.parse(trimmedValue);
        case 'bool':
            return trimmedValue.toLowerCase() === 'true';
        case 'int':
            return parseInt(trimmedValue);
        case 'float':
            return parseFloat(trimmedValue);
        default:
            return trimmedValue;
    }
}

// Add placeholder text to show empty value format
function renderInput(fieldName, fieldConfig) {
    // ... (previous code remains the same)

    inputElement.placeholder = fieldConfig.datatype === 'dict' ? 
        'Enter JSON object or {}' : 
        'Enter value or "" for empty';

    // ... (rest of the function remains the same)
}
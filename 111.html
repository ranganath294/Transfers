<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Config Generator</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <style>
        body {
            background-color: #f4f6f9;
            font-family: 'Inter', sans-serif;
        }
        .config-container {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 30px;
            margin-top: 30px;
        }
        .form-control, .btn {
            border-radius: 8px;
        }
        .required-label::after {
            content: " *";
            color: red;
        }
        .config-field {
            margin-bottom: 20px;
        }
        .config-field small {
            color: #6c757d;
        }
        
        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .config-container {
                padding: 15px;
                margin-top: 15px;
            }
            .btn-group {
                flex-direction: column;
            }
            .btn-group > .btn {
                margin-bottom: 10px;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8 config-container">
                <h2 class="mb-4 text-center">Config Generator</h2>
                
                <!-- Config Selection Section -->
                <div id="configSelectionSection">
                    <div class="mb-3">
                        <label for="configSelect" class="form-label">Select Configuration</label>
                        <select id="configSelect" class="form-select">
                            <option value="">Choose a configuration</option>
                            <!-- Dynamically populate this with available configs -->
                            <option value="config1">Configuration 1</option>
                            <option value="config2">Configuration 2</option>
                        </select>
                    </div>
                    <div class="text-center">
                        <button id="showConfigBtn" class="btn btn-primary">Show Configuration</button>
                    </div>
                </div>

                <!-- Config Editing Section (Initially Hidden) -->
                <div id="configEditSection" style="display:none;">
                    <form id="configForm">
                        <div id="dynamicConfigFields">
                            <!-- Dynamically generated config fields will appear here -->
                        </div>
                        <div class="btn-group mt-3 w-100">
                            <button type="submit" class="btn btn-success">Save Configuration</button>
                            <button type="button" id="cancelConfigBtn" class="btn btn-secondary">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const configSelect = document.getElementById('configSelect');
            const showConfigBtn = document.getElementById('showConfigBtn');
            const configSelectionSection = document.getElementById('configSelectionSection');
            const configEditSection = document.getElementById('configEditSection');
            const dynamicConfigFields = document.getElementById('dynamicConfigFields');
            const cancelConfigBtn = document.getElementById('cancelConfigBtn');
            const configForm = document.getElementById('configForm');

            // Dummy config data (replace with your actual config structure)
            const configData = {
                'config1': {
                    'server_host': { 
                        default: 'localhost', 
                        type: 'string', 
                        ui_displayed_name: 'Server Host' 
                    },
                    'port': { 
                        default: 8000, 
                        type: 'number', 
                        ui_displayed_name: 'Port Number' 
                    },
                    'debug_mode': { 
                        default: false, 
                        type: 'boolean', 
                        ui_displayed_name: 'Debug Mode' 
                    }
                },
                'config2': {
                    'database_url': { 
                        default: 'postgresql://user:pass@localhost/db', 
                        type: 'string', 
                        ui_displayed_name: 'Database URL' 
                    },
                    'max_connections': { 
                        default: 10, 
                        type: 'number', 
                        ui_displayed_name: 'Max Connections' 
                    }
                }
            };

            // Render input based on field type
            function renderConfigField(fieldName, fieldConfig) {
                const fieldDiv = document.createElement('div');
                fieldDiv.className = 'config-field';

                const label = document.createElement('label');
                label.htmlFor = fieldName;
                label.className = 'form-label required-label';
                label.textContent = fieldConfig.ui_displayed_name;

                let input;
                switch (fieldConfig.type) {
                    case 'boolean':
                        input = document.createElement('select');
                        input.className = 'form-select';
                        ['true', 'false'].forEach(val => {
                            const option = document.createElement('option');
                            option.value = val;
                            option.textContent = val;
                            option.selected = val === String(fieldConfig.default);
                            input.appendChild(option);
                        });
                        break;
                    case 'number':
                        input = document.createElement('input');
                        input.type = 'number';
                        input.value = fieldConfig.default;
                        break;
                    default:
                        input = document.createElement('input');
                        input.type = 'text';
                        input.value = fieldConfig.default;
                }

                input.id = fieldName;
                input.name = fieldName;
                input.className = 'form-control';

                const helpText = document.createElement('small');
                helpText.className = 'form-text';
                helpText.textContent = `Default: ${fieldConfig.default}`;

                fieldDiv.appendChild(label);
                fieldDiv.appendChild(input);
                fieldDiv.appendChild(helpText);

                return fieldDiv;
            }

            // Show Configuration Button Click
            showConfigBtn.addEventListener('click', function() {
                const selectedConfig = configSelect.value;
                if (selectedConfig && configData[selectedConfig]) {
                    // Clear previous fields
                    dynamicConfigFields.innerHTML = '';

                    // Render config fields
                    const config = configData[selectedConfig];
                    Object.entries(config).forEach(([fieldName, fieldConfig]) => {
                        dynamicConfigFields.appendChild(
                            renderConfigField(fieldName, fieldConfig)
                        );
                    });

                    // Toggle sections
                    configSelectionSection.style.display = 'none';
                    configEditSection.style.display = 'block';
                }
            });

            // Cancel Button
            cancelConfigBtn.addEventListener('click', function() {
                configSelectionSection.style.display = 'block';
                configEditSection.style.display = 'none';
            });

            // Form Submission
            configForm.addEventListener('submit', function(event) {
                event.preventDefault();
                const formData = new FormData(configForm);
                const configObject = {};

                for (let [key, value] of formData.entries()) {
                    const configField = configData[configSelect.value][key];
                    
                    // Convert value based on original type
                    if (configField.type === 'number') {
                        configObject[key] = Number(value);
                    } else if (configField.type === 'boolean') {
                        configObject[key] = value === 'true';
                    } else {
                        configObject[key] = value;
                    }
                }

                console.log('Saved Configuration:', configObject);
                alert('Configuration saved successfully!');

                // Optional: Send to backend via fetch
                // fetch('/save-config', {
                //     method: 'POST',
                //     body: JSON.stringify(configObject)
                // })
            });
        });
    </script>
</body>
</html>
{% extends "generate_config/base.html" %}
{% load static %}

<!-- [Previous content remains the same until the validation function] -->

<script>
    // Function to validate input based on datatype
    function validateInput(input) {
        // Skip validation for non-input elements
        if (!input.tagName || !['INPUT', 'TEXTAREA'].includes(input.tagName)) {
            return true;
        }

        // Skip validation for data_ranga_pivot field
        if (input.name === 'data_ranga_pivot') {
            input.classList.remove('is-invalid', 'is-valid');
            return true;
        }
    
        const value = input.value.trim();
        const datatype = input.dataset.datatype;
        
        // Rest of validation logic remains the same...
        let validationMessage = document.getElementById(`${input.id}-validation`);
        if (!validationMessage) {
            validationMessage = document.createElement('div');
            validationMessage.className = 'invalid-feedback';
            validationMessage.id = `${input.id}-validation`;
            input.parentNode.appendChild(validationMessage);
        }

        // [Rest of the validation function remains the same]
    }

    // Function to parse value based on datatype
    function parseValue(value, datatype) {
        // Special handling for data_ranga_pivot - return as is
        if (value === 'data_ranga_pivot') {
            return value;
        }

        const trimmedValue = value.trim();
    
        // Handle intentionally empty values (except boolean)
        if (datatype !== 'bool' && trimmedValue === '""') {
            switch (datatype) {
                case 'str': return '';
                case 'list': return [];
                case 'dict': return {};
                case 'int':
                case 'float': return null;
                default: return '';
            }
        }
    
        // [Rest of the parseValue function remains the same]
    }

    // Modify the renderInput function to skip adding datatype rules for data_ranga_pivot
    function renderInput(fieldName, fieldConfig) {
        const inputWrapper = document.createElement('div');
        inputWrapper.className = 'col-md-6 mb-3';
    
        // Create label
        const label = document.createElement('label');
        label.htmlFor = fieldName;
        label.className = `form-label ${fieldConfig.required !== false ? 'required-label' : ''}`;
        label.textContent = `${fieldConfig.ui_displayed_name} ${fieldConfig.required !== false ? '(required)' : '(optional)'}`;
        inputWrapper.appendChild(label);
    
        // Create input element
        let inputElement;
        if (fieldName === 'data_ranga_pivot') {
            // Simple text input for data_ranga_pivot
            inputElement = document.createElement('input');
            inputElement.type = 'text';
            inputElement.value = fieldConfig.default;
        } else {
            // Normal input creation logic for other fields
            if (fieldConfig.datatype === 'dict') {
                inputElement = document.createElement('textarea');
                inputElement.value = JSON.stringify(fieldConfig.default, null, 2);
            } else {
                inputElement = document.createElement('input');
                inputElement.type = 'text';
                inputElement.value = fieldConfig.default;
            }
        }
    
        inputElement.id = fieldName;
        inputElement.name = fieldName;
        inputElement.className = 'form-control';
        
        // Only add datatype and placeholder for non-data_ranga_pivot fields
        if (fieldName !== 'data_ranga_pivot') {
            inputElement.dataset.datatype = fieldConfig.datatype;
            inputElement.placeholder = fieldConfig.datatype === 'dict' ? 'Enter JSON object or {}' : 'Enter value or "" for empty';
        } else {
            inputElement.placeholder = 'Enter value';
        }
        
        if (fieldConfig.required !== false) {
            inputElement.required = true;
        }
    
        inputWrapper.appendChild(inputElement);
    
        // Add example text
        if (fieldName !== 'data_ranga_pivot') {
            // Add example text and validation rules as before for other fields
            // [Example text and validation rules code remains the same]
        }
    
        return inputWrapper;
    }

    // [Rest of the code remains the same]
</script>

{% endblock %}
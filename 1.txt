document.addEventListener('DOMContentLoaded', function() {
    const devicesData = JSON.parse(document.getElementById('devices-data').textContent);
    const tableBody = document.getElementById('results-table-body');

    devicesData.forEach(device => {
        const row = document.createElement('tr');
        
        // Use columnNames array to maintain the correct order of columns
        columnNames.forEach(colName => {
            const cell = document.createElement('td');
            
            // First set the text content for all cells
            cell.textContent = device[colName] || '';
            
            // If it's the Edit column, append the icon after the text
            if (colName === "Edit") {
                // Create the edit icon
                const editIcon = document.createElement('i');
                editIcon.className = 'fas fa-edit edit-icon';
                editIcon.setAttribute('title', 'Edit User Assignment');
                
                // Add click event listener to the edit icon
                editIcon.addEventListener('click', function(e) {
                    e.stopPropagation();
                    console.log('Edit clicked for:', device);
                });
                
                // Clear the cell and create a container div
                const container = document.createElement('div');
                container.className = 'user-cell';
                
                // Create text span
                const textSpan = document.createElement('span');
                textSpan.className = 'user-text';
                textSpan.textContent = device[colName] || '';
                
                // Add both text and icon to container
                container.appendChild(textSpan);
                container.appendChild(editIcon);
                
                // Clear cell and add container
                cell.textContent = '';
                cell.appendChild(container);
            }

            row.appendChild(cell);
        });
        
        tableBody.appendChild(row);
    });
});
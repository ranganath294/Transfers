{# templates/iot_catalogue/components/optimized_select.html #}
{% raw %}
{% load static %}

<div class="optimized-select-wrapper" id="{{ wrapper_id }}">
    <button type="button" class="optimized-select-button form-select" id="{{ button_id }}">
        {{ default_text|default:"Choose..." }}
    </button>
    <div class="optimized-select-dropdown" id="{{ dropdown_id }}">
        <input type="text" class="optimized-select-search form-control" id="{{ search_id }}" placeholder="Search...">
        <div class="optimized-select-options" id="{{ options_id }}">
            <div class="virtual-scroll-container" id="{{ virtual_scroll_id }}"></div>
        </div>
    </div>
</div>
{% endraw %}

{# templates/iot_catalogue/components/search_form.html #}
{% raw %}
<form id="iot-search-form" method="post" action="{% url 'iot_catalogue:search' %}" class="row g-3">
    {% csrf_token %}
    <div class="col-md-6" id="search-form-left-col">
        <div class="mb-3" id="device-type-container">
            <label class="form-label" for="device-type-select">Device Type</label>
            {% include "iot_catalogue/components/optimized_select.html" with 
                wrapper_id="device-type-wrapper"
                button_id="device-type-button"
                dropdown_id="device-type-dropdown"
                search_id="device-type-search"
                options_id="device-type-options"
                virtual_scroll_id="device-type-virtual-scroll"
                name="device_type"
                default_text="-- All --"
            %}
        </div>
        <!-- Other form fields... -->
    </div>
</form>
{% endraw %}

{# templates/iot_catalogue/components/results_table.html #}
{% raw %}
<div class="card-body" id="results-card">
    <div class="table-shadow" id="results-table-container">
        <div class="table-container" id="results-scrollable-container">
            <table class="table table-hover table-sticky mb-0" id="results-table">
                <thead>
                    <tr class="bg-light" id="results-header-row">
                        {% for col_name in column_names %}
                            <th class="fw-semibold" id="col-header-{{ col_name|lower|slugify }}">{{ col_name }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody id="results-table-body"></tbody>
            </table>
        </div>
    </div>
</div>
{% endraw %}

{# templates/iot_catalogue/components/user_assignment_modal.html #}
{% raw %}
<div class="modal fade" id="userAssignmentModal" tabindex="-1" aria-labelledby="userAssignmentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" id="userAssignmentDialog">
        <div class="modal-content" id="userAssignmentContent">
            <div class="modal-header">
                <h5 class="modal-title" id="userAssignmentModalLabel">Assign User</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="userSelect" class="form-label">Select User</label>
                    {% include "iot_catalogue/components/optimized_select.html" with 
                        wrapper_id="user-select-wrapper"
                        button_id="user-select-button"
                        dropdown_id="user-select-dropdown"
                        search_id="user-select-search"
                        options_id="user-select-options"
                        virtual_scroll_id="user-select-virtual-scroll"
                        name="user"
                        default_text="Choose..."
                    %}
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="userAssignmentModalSaveBtn">Save changes</button>
            </div>
        </div>
    </div>
</div>
{% endraw %}








/* static/iot_catalogue/css/optimized-select.css */
.optimized-select-wrapper {
    position: relative;
    width: 100%;
}

.optimized-select-button {
    width: 100%;
    text-align: left;
    cursor: pointer;
}

.optimized-select-dropdown {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 0.375rem;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    z-index: 1000;
    margin-top: 0.25rem;
}

/* Rest of the optimized select styles... */

/* static/iot_catalogue/css/results-table.css */
.table-container {
    position: relative;
    max-height: calc(100vh - 300px);
    overflow: auto;
}

.table-sticky thead {
    position: sticky;
    top: 0;
    z-index: 1;
    background-color: #f8f9fa;
}

/* Rest of the table styles... */

/* static/iot_catalogue/js/optimized-select.js */
class OptimizedSelect {
    constructor(originalSelect, options = {}) {
        this.originalSelect = originalSelect;
        this.options = options;
        this.itemHeight = 35;
        this.visibleItems = 8;
        this.allOptions = Array.from(originalSelect.options).map(opt => ({
            value: opt.value,
            label: opt.text
        }));
        this.isOpen = false;

        this.init();
    }

    // Rest of the OptimizedSelect class implementation...
}

/* static/iot_catalogue/js/results-table.js */
class ResultsTable {
    constructor(tableId, data) {
        this.table = document.getElementById(tableId);
        this.data = data;
        this.init();
    }

    init() {
        this.renderRows();
        this.initializeUserAssignment();
    }

    // Rest of the ResultsTable class implementation...
}







{# templates/iot_catalogue/search.html #}
{% raw %}
{% extends 'iot_catalogue/base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'iot_catalogue/css/optimized-select.css' %}">
<link rel="stylesheet" href="{% static 'iot_catalogue/css/results-table.css' %}">
{% endblock %}

{% block content_div %}
{% include "iot_catalogue/components/search_form.html" %}
{% include "iot_catalogue/components/user_assignment_modal.html" %}
{% endblock %}

{% block results_div %}
{% if devices %}
    {% include "iot_catalogue/components/results_table.html" %}
    
    <script id="devices-data" type="application/json">
        {{ devices|safe }}
    </script>
{% endif %}
{% endblock %}

{% block extra_js %}
<script src="{% static 'iot_catalogue/js/optimized-select.js' %}"></script>
<script src="{% static 'iot_catalogue/js/results-table.js' %}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize optimized selects
        document.querySelectorAll('.optimized-select').forEach(select => {
            new OptimizedSelect(select);
        });

        // Initialize results table if data exists
        const devicesDataElement = document.getElementById('devices-data');
        if (devicesDataElement) {
            const devicesData = JSON.parse(devicesDataElement.textContent);
            new ResultsTable('results-table', devicesData);
        }
    });
</script>
{% endblock %}
{% endraw %}








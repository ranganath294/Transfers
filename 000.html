function renderMetricsTable(data, containerId) {
    // Helper function to format percentages
    const formatPercentage = (value) => {
        return value ? value.toFixed(1) + '%' : '0.0%';
    };

    // Create table element
    const table = document.createElement('table');
    table.className = 'metrics-table';
    
    // Create header
    const thead = document.createElement('thead');
    const headerRow = document.createElement('tr');
    const headers = ['SP Name', 'Test Team', 'Phase', 'Date', 'Coverage %', 'Pass %', 'Fail %', 'Block %'];
    
    headers.forEach(text => {
        const th = document.createElement('th');
        th.textContent = text;
        headerRow.appendChild(th);
    });
    
    thead.appendChild(headerRow);
    table.appendChild(thead);
    
    // Create table body
    const tbody = document.createElement('tbody');
    
    // Process each SP
    data.forEach(sp => {
        let isFirstSpRow = true;
        const spRowspan = sp.teams.reduce((acc, team) => acc + team.phases.length, 0);
        
        sp.teams.forEach(team => {
            let isFirstTeamRow = true;
            const teamRowspan = team.phases.length;
            
            team.phases.forEach(phase => {
                const row = document.createElement('tr');
                
                // SP Name cell (only on first row of the SP)
                if (isFirstSpRow) {
                    const spCell = document.createElement('td');
                    spCell.textContent = sp.sp_name;
                    spCell.rowSpan = spRowspan;
                    row.appendChild(spCell);
                    isFirstSpRow = false;
                }
                
                // Team Name cell (only on first row of the team)
                if (isFirstTeamRow) {
                    const teamCell = document.createElement('td');
                    teamCell.textContent = team.team_name;
                    teamCell.rowSpan = teamRowspan;
                    row.appendChild(teamCell);
                    isFirstTeamRow = false;
                }
                
                // Phase cell
                const phaseCell = document.createElement('td');
                phaseCell.textContent = phase.phase;
                row.appendChild(phaseCell);
                
                // Date cell
                const dateCell = document.createElement('td');
                dateCell.textContent = phase.date;
                row.appendChild(dateCell);
                
                // Metrics cells
                const metrics = phase.metrics;
                const metricsArray = [
                    metrics.coverage_percentage,
                    metrics.passed_percentage,
                    metrics.failed_percentage,
                    metrics.blocked_percentage
                ];
                
                metricsArray.forEach(value => {
                    const cell = document.createElement('td');
                    cell.textContent = formatPercentage(value);
                    row.appendChild(cell);
                });
                
                tbody.appendChild(row);
            });
        });
    });
    
    table.appendChild(tbody);
    
    // Add some basic CSS
    const style = document.createElement('style');
    style.textContent = `
        .metrics-table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        .metrics-table th,
        .metrics-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .metrics-table th {
            background-color: #f5f5f5;
            font-weight: bold;
        }
        .metrics-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .metrics-table tr:hover {
            background-color: #f5f5f5;
        }
    `;
    
    document.head.appendChild(style);
    
    // Clear and append to container
    const container = document.getElementById(containerId);
    container.innerHTML = '';
    container.appendChild(table);
}

// Example usage:
// renderMetricsTable(data, 'tableContainer');
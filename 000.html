function addRowHighlighting() {
    const rows = document.querySelectorAll('.phase-row');
    
    // First, let's add hierarchical data attributes to map relationships
    let spMapping = {};
    let teamMapping = {};
    let phaseMapping = {};
    
    rows.forEach(row => {
        const spName = row.getAttribute('data-sp-name');
        const team = row.getAttribute('data-team');
        const phase = row.getAttribute('data-phase');
        const rowIndex = row.getAttribute('data-row-index');
        
        // Build SP hierarchy
        if (!spMapping[spName]) {
            spMapping[spName] = {
                teams: new Set(),
                rows: new Set()
            };
        }
        spMapping[spName].teams.add(team);
        spMapping[spName].rows.add(rowIndex);
        
        // Build Team hierarchy
        const teamKey = `${spName}-${team}`;
        if (!teamMapping[teamKey]) {
            teamMapping[teamKey] = {
                phases: new Set(),
                rows: new Set()
            };
        }
        teamMapping[teamKey].phases.add(phase);
        teamMapping[teamKey].rows.add(rowIndex);
        
        // Build Phase hierarchy
        const phaseKey = `${spName}-${team}-${phase}`;
        if (!phaseMapping[phaseKey]) {
            phaseMapping[phaseKey] = new Set();
        }
        phaseMapping[phaseKey].add(rowIndex);
        
        // Add hierarchy data to row
        row.setAttribute('data-hierarchy', JSON.stringify({
            sp: spName,
            team: teamKey,
            phase: phaseKey
        }));
    });
    
    // Add highlighting events
    rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        
        cells.forEach((cell, cellIndex) => {
            cell.addEventListener('mouseenter', () => {
                const hierarchy = JSON.parse(row.getAttribute('data-hierarchy'));
                
                // Clear previous highlights
                document.querySelectorAll('.highlighted-team').forEach(el => {
                    el.classList.remove('highlighted-team');
                });
                
                // Highlight based on cell position (column)
                if (cellIndex === 0) { // SP cell
                    // Highlight all rows belonging to this SP
                    const spRows = spMapping[hierarchy.sp].rows;
                    highlightRows(spRows);
                    
                } else if (cellIndex === 1) { // Team cell
                    // Highlight all rows belonging to this team and its SP
                    const teamRows = teamMapping[hierarchy.team].rows;
                    highlightRows(teamRows);
                    highlightParentSP(hierarchy.sp);
                    
                } else if (cellIndex === 3) { // Phase cell
                    // Highlight all rows belonging to this phase, its team and SP
                    const phaseRows = phaseMapping[hierarchy.phase];
                    highlightRows(phaseRows);
                    highlightParentTeam(hierarchy.team);
                    highlightParentSP(hierarchy.sp);
                    
                } else { // Coverage type or metric cells
                    // Highlight this specific row and all its parents
                    row.classList.add('highlighted-team');
                    highlightParentPhase(hierarchy.phase);
                    highlightParentTeam(hierarchy.team);
                    highlightParentSP(hierarchy.sp);
                }
            });
        });
    });
    
    function highlightRows(rowIndices) {
        rowIndices.forEach(index => {
            const row = document.querySelector(`.phase-row[data-row-index="${index}"]`);
            if (row) row.classList.add('highlighted-team');
        });
    }
    
    function highlightParentSP(spName) {
        const spCell = document.querySelector(`td[data-sp-cell="true"]`);
        if (spCell && spCell.textContent.trim() === spName) {
            spCell.classList.add('highlighted-team');
        }
    }
    
    function highlightParentTeam(teamKey) {
        const [spName, team] = teamKey.split('-');
        const teamCells = document.querySelectorAll('td[data-team-cell="true"]');
        teamCells.forEach(cell => {
            if (cell.textContent.trim() === team) {
                cell.classList.add('highlighted-team');
            }
        });
    }
    
    function highlightParentPhase(phaseKey) {
        const [spName, team, phase] = phaseKey.split('-');
        const rows = document.querySelectorAll('.phase-row');
        rows.forEach(row => {
            if (row.getAttribute('data-phase') === phase) {
                const phaseCells = row.querySelectorAll('td');
                phaseCells.forEach(cell => {
                    if (cell.textContent.trim() === phase) {
                        cell.classList.add('highlighted-team');
                    }
                });
            }
        });
    }
    
    // Add mouseleave event to table
    document.querySelector('.table').addEventListener('mouseleave', () => {
        document.querySelectorAll('.highlighted-team').forEach(el => {
            el.classList.remove('highlighted-team');
        });
    });
}






.highlighted-team {
    background-color: rgba(0, 123, 255, 0.15) !important;
    transition: background-color 0.2s ease;
}

.phase-row td {
    position: relative;
}

.highlighted-team::after {
    content: '';
    position: absolute;
    right: -1px;
    top: 50%;
    width: 2px;
    height: 50%;
    background-color: rgba(0, 123, 255, 0.3);
    transform: translateY(-50%);
}

td[data-sp-cell="true"].highlighted-team {
    background-color: rgba(0, 123, 255, 0.2) !important;
}

td[data-team-cell="true"].highlighted-team {
    background-color: rgba(0, 123, 255, 0.17) !important;
}


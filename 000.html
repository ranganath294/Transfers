function renderInnerTable_1(data, selectedTeam, selectedPhase, parentRow) {
    // First, find the correct SP and team data
    const spData = data.find(sp => 
        sp.teams.some(team => team.team_name === selectedTeam)
    );

    if (!spData) return null;

    const teamData = spData.teams.find(team => team.team_name === selectedTeam);
    if (!teamData) return null;

    // Find the phase with matching name and coverage types
    const phaseData = teamData.phases.find(phase => phase.phase === selectedPhase);
    if (!phaseData || !phaseData.coverage_types) return null;

    // Create inner table container
    const innerTableContainer = document.createElement('tr');
    innerTableContainer.className = 'inner-table-container';
    
    const innerTableCell = document.createElement('td');
    innerTableCell.setAttribute('colspan', '12');  // Match total columns
    
    const innerTable = document.createElement('table');
    innerTable.className = 'inner-coverage-types-table';
    innerTable.style.cssText = `
        width: 98%;
        margin: 10px auto;
        border-collapse: collapse;
        background-color: #f9f9f9;
        box-shadow: 0 2px 3px rgba(0,0,0,0.1);
    `;

    // Create inner table header
    const thead = document.createElement('thead');
    const headerRow = document.createElement('tr');
    headerRow.style.backgroundColor = '#328AA4';
    headerRow.style.color = 'white';

    const headers = [
        'Coverage Type', 
        'Total TCs',
        'Coverage', 'Coverage %',
        'Passed', 'Pass %',
        'Failed', 'Fail %',
        'Blocked', 'Block %',
        'Unique CRs', 
        'Unique JIRAs'
    ];

    headers.forEach(header => {
        const th = document.createElement('th');
        th.textContent = header;
        th.style.padding = '8px';
        th.style.border = '1px solid #ddd';
        headerRow.appendChild(th);
    });

    thead.appendChild(headerRow);
    innerTable.appendChild(thead);

    // Create table body
    const tbody = document.createElement('tbody');

    // Render coverage types
    phaseData.coverage_types.forEach(coverageType => {
        const tr = document.createElement('tr');
        
        const cells = [
            coverageType.coverage_type,
            coverageType.metrics.total,
            coverageType.metrics.coverage,
            formatPercentage(coverageType.metrics.coverage_percentage),
            coverageType.metrics.passed,
            formatPercentage(coverageType.metrics.passed_percentage),
            coverageType.metrics.failed,
            formatPercentage(coverageType.metrics.failed_percentage),
            coverageType.metrics.blocked,
            formatPercentage(coverageType.metrics.blocked_percentage)
        ];

        cells.forEach(cellData => {
            const td = document.createElement('td');
            td.textContent = cellData;
            td.style.border = '1px solid #ddd';
            td.style.padding = '6px';
            tr.appendChild(td);
        });

        // Add Unique CRs column
        const crTd = document.createElement('td');
        crTd.innerHTML = formatLongList(coverageType.unique_cr_list, coverageType.unique_cr_count);
        crTd.style.border = '1px solid #ddd';
        crTd.style.padding = '6px';
        tr.appendChild(crTd);

        // Add Unique JIRAs column
        const jiraTd = document.createElement('td');
        jiraTd.innerHTML = formatLongList(coverageType.unique_jira_list, coverageType.unique_jira_count);
        jiraTd.style.border = '1px solid #ddd';
        jiraTd.style.padding = '6px';
        tr.appendChild(jiraTd);

        tbody.appendChild(tr);
    });

    innerTable.appendChild(tbody);
    innerTableCell.appendChild(innerTable);
    innerTableContainer.appendChild(innerTableCell);

    // Insert the inner table row right after the parent row
    parentRow.insertAdjacentElement('afterend', innerTableContainer);

    return innerTableContainer;
}

// Modify the renderCumulativeTable function
function renderCumulativeTable(data, targetElementId) {
    const table = document.createElement('table');
    table.className = 'coverage-table';

    // Create header
    const thead = document.createElement('thead');
    const headerRow = document.createElement('tr');
    const headers = [
        'Expand',  // New column for expand/collapse
        'Phase', 
        'Total TCs',
        'Coverage', 'Coverage %',
        'Passed', 'Pass %',
        'Failed', 'Fail %',
        'Blocked', 'Block %',
        'Unique CRs',
        'Unique JIRAs'
    ];
    headers.forEach(header => {
        const th = document.createElement('th');
        th.textContent = header;
        headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);
    table.appendChild(thead);

    // Create table body
    const tbody = document.createElement('tbody');
    
    // Get the current selected team from the team filter
    const selectedTeam = document.querySelector('input[name="team-filter"]:checked').value;

    data.forEach(sp => {
        // Filter for the selected team
        const teamData = sp.teams.find(team => team.team_name === selectedTeam);
        if (!teamData) return;

        teamData.phases.forEach(phase => {
            const tr = document.createElement('tr');
            
            // Expand/Collapse column
            const expandTd = document.createElement('td');
            const expandIcon = document.createElement('span');
            expandIcon.innerHTML = '➕';  // Plus icon
            expandIcon.style.cssText = `
                cursor: pointer;
                padding: 0 5px;
                font-weight: bold;
                color: #328AA4;
            `;
            expandIcon.setAttribute('data-expanded', 'false');
            
            expandIcon.addEventListener('click', (e) => {
                const parentRow = e.target.closest('tr');
                const isExpanded = e.target.getAttribute('data-expanded') === 'true';
                
                // Remove any existing inner tables
                const existingInnerTable = parentRow.nextElementSibling;
                if (existingInnerTable && existingInnerTable.classList.contains('inner-table-container')) {
                    existingInnerTable.remove();
                    e.target.innerHTML = '➕';
                    e.target.setAttribute('data-expanded', 'false');
                    return;
                }

                // Render inner table
                renderInnerTable_1(data, selectedTeam, phase.phase, parentRow);
                e.target.innerHTML = '➖';  // Minus icon
                e.target.setAttribute('data-expanded', 'true');
            });

            expandTd.appendChild(expandIcon);
            tr.appendChild(expandTd);

            // Rest of the row cells
            const cells = [
                phase.phase,
                phase.metrics.total,
                phase.metrics.coverage,
                formatPercentage(phase.metrics.coverage_percentage),
                phase.metrics.passed,
                formatPercentage(phase.metrics.passed_percentage),
                phase.metrics.failed,
                formatPercentage(phase.metrics.failed_percentage),
                phase.metrics.blocked,
                formatPercentage(phase.metrics.blocked_percentage)
            ];

            cells.forEach(cellData => {
                const td = document.createElement('td');
                td.textContent = cellData;
                tr.appendChild(td);
            });

            // Add Unique CRs column
            const crTd = document.createElement('td');
            crTd.innerHTML = formatLongList(phase.unique_cr_list, phase.unique_cr_count);
            tr.appendChild(crTd);

            // Add Unique JIRAs column
            const jiraTd = document.createElement('td');
            jiraTd.innerHTML = formatLongList(phase.unique_jira_list, phase.unique_jira_count);
            tr.appendChild(jiraTd);

            tbody.appendChild(tr);
        });
    });

    table.appendChild(tbody);

    // Render the table
    const targetElement = document.getElementById(targetElementId);
    targetElement.innerHTML = '';
    targetElement.appendChild(table);

    // Add event listeners for "more" links
    targetElement.addEventListener('click', (e) => {
        if (e.target.classList.contains('show-more-list')) {
            e.preventDefault();
            const title = e.target.getAttribute('data-title');
            const list = JSON.parse(decodeURIComponent(e.target.getAttribute('data-list')));
            createListModal(title, list);
        }
    });

    // Adjust column widths
    adjustColumnWidths();
}
{% extends 'base.html' %}
{% block content %}
<div class="container container-fluid">
    <!-- Keep existing header content unchanged -->
    <div class="table-responsive">
        <table id="activeSpsTable" class="table table-bordered table-hover">
            <thead class="thead-light">
                <tr>
                    <th>SP Name</th>
                    <th>Test Team</th>
                    <th>Date</th>
                    <th>Phase</th>
                    <th>Coverage Type</th>
                    <th>Total TCs</th>
                    <th>Coverage</th>
                    <th>Coverage %</th>
                    <th>Passed</th>
                    <th>Pass %</th>
                    <th>Failed</th>
                    <th>Fail %</th>
                    <th>Blocked</th>
                    <th>Block %</th>
                </tr>
            </thead>
            <tbody id="tableBody">
            </tbody>
        </table>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Keep existing initialization code unchanged
    
    function formatPercent(value) {
        return typeof value === 'number' ? value.toFixed(1) : 'NA';
    }
    
    function createTooltipCell(value, tooltipText) {
        return `
            <td class="tooltip-cell metric-cell text-center">
                ${value || 0}
                <span class="custom-tooltip">${tooltipText}</span>
            </td>
        `;
    }
    
    function createPercentageCell(percentage, tooltipText) {
        return `
            <td class="tooltip-cell metric-cell text-center">
                ${formatPercent(percentage)}%
                <span class="custom-tooltip">${tooltipText}</span>
            </td>
        `;
    }
    
    function renderTable() {
        if (!tableData) return;
        
        tableBody.innerHTML = '';
        let rowCounter = 0;
        
        tableData.forEach((spData) => {
            const filteredTeams = spData.teams.filter(team => 
                selectedTeams.includes('all') || selectedTeams.includes(team.team_name)
            );
            
            filteredTeams.forEach((team) => {
                team.phases.forEach((phase) => {
                    // Create a row for each coverage type
                    phase.coverage_types.forEach((coverageData) => {
                        let row = document.createElement('tr');
                        row.className = 'phase-row';
                        row.setAttribute('data-row-index', rowCounter++);
                        row.setAttribute('data-team', team.team_name);
                        row.setAttribute('data-phase', phase.phase);
                        row.setAttribute('data-sp-name', spData.sp_name);
                        
                        const tooltipBase = `${spData.sp_name} ${team.team_name} ${phase.phase} ${coverageData.coverage_type}`;
                        const metrics = coverageData.metrics;
                        
                        row.innerHTML = `
                            <td>${spData.sp_name}</td>
                            <td>${team.team_name}</td>
                            <td>${phase.date}</td>
                            <td>${phase.phase}</td>
                            <td>${coverageData.coverage_type}</td>
                            ${createTooltipCell(metrics.total, `${tooltipBase} Total ${metrics.total}`)}
                            ${createTooltipCell(metrics.coverage, `${tooltipBase} Coverage ${metrics.coverage}`)}
                            ${createPercentageCell(metrics.coverage_percentage, `${tooltipBase} Coverage ${formatPercent(metrics.coverage_percentage)}%`)}
                            ${createTooltipCell(metrics.passed, `${tooltipBase} Passed ${metrics.passed}`)}
                            ${createPercentageCell(metrics.passed_percentage, `${tooltipBase} Pass ${formatPercent(metrics.passed_percentage)}%`)}
                            ${createTooltipCell(metrics.failed, `${tooltipBase} Failed ${metrics.failed}`)}
                            ${createPercentageCell(metrics.failed_percentage, `${tooltipBase} Fail ${formatPercent(metrics.failed_percentage)}%`)}
                            ${createTooltipCell(metrics.blocked, `${tooltipBase} Blocked ${metrics.blocked}`)}
                            ${createPercentageCell(metrics.blocked_percentage, `${tooltipBase} Block ${formatPercent(metrics.blocked_percentage)}%`)}
                        `;
                        
                        tableBody.appendChild(row);
                    });
                });
            });
        });
        
        addRowHighlighting();
    }
    
    // Keep existing event handlers and highlighting code unchanged
});
</script>

<style>
/* Keep existing styles unchanged, just add this one new style */
.coverage-type {
    font-weight: 500;
    color: #666;
}
</style>
{% endblock %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // ... (previous existing code)

        // Configuration for list display
        const LIST_THRESHOLD = 15;

        // Function to create a modal for displaying full lists
        function createListModal(title, list) {
            // Create modal container
            const modal = document.createElement('div');
            modal.className = 'list-modal';
            modal.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                border: 1px solid #ccc;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                width: 80vw;
                max-width: 1000px;
                max-height: 70vh;
                overflow: hidden;
                z-index: 1000;
                border-radius: 8px;
            `;

            // Modal header (matching table header style)
            const header = document.createElement('div');
            header.style.cssText = `
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 10px;
                border-bottom: 1px solid #eee;
                background-color: #328AA4;
                color: white;
            `;
            const titleEl = document.createElement('h3');
            titleEl.textContent = title;
            titleEl.style.margin = '0';

            // Close button
            const closeBtn = document.createElement('button');
            closeBtn.textContent = 'âœ•';
            closeBtn.style.cssText = `
                background: none;
                border: none;
                font-size: 20px;
                cursor: pointer;
                color: white;
            `;
            closeBtn.addEventListener('click', () => {
                document.body.removeChild(modal);
                document.body.removeChild(overlay);
            });

            header.appendChild(titleEl);
            header.appendChild(closeBtn);

            // Modal content (scrollable list)
            const content = document.createElement('div');
            content.style.cssText = `
                max-height: 50vh;
                overflow-y: auto;
                padding: 10px;
            `;

            // Create grid-like layout for list items
            const listContainer = document.createElement('div');
            listContainer.style.cssText = `
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 10px;
                padding: 10px;
            `;

            list.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.textContent = item;
                itemEl.style.cssText = `
                    border: 1px solid #eee;
                    padding: 5px;
                    background-color: #f9f9f9;
                    border-radius: 4px;
                    word-break: break-all;
                `;
                listContainer.appendChild(itemEl);
            });

            content.appendChild(listContainer);

            // Overlay
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                z-index: 999;
            `;
            overlay.addEventListener('click', () => {
                document.body.removeChild(modal);
                document.body.removeChild(overlay);
            });

            modal.appendChild(header);
            modal.appendChild(content);

            document.body.appendChild(overlay);
            document.body.appendChild(modal);
        }

        // Function to format long lists with vertical display
        function formatLongList(list, count) {
            if (count <= LIST_THRESHOLD) {
                // Create a vertical list for inline display
                const listContainer = document.createElement('div');
                listContainer.style.cssText = `
                    display: grid;
                    grid-template-columns: repeat(3, 1fr);
                    gap: 5px;
                    max-width: 300px;
                    max-height: 100px;
                    overflow-y: auto;
                `;

                list.forEach(item => {
                    const itemEl = document.createElement('div');
                    itemEl.textContent = item;
                    itemEl.style.cssText = `
                        border: 1px solid #eee;
                        padding: 2px;
                        font-size: 0.8em;
                        word-break: break-all;
                        background-color: #f9f9f9;
                        border-radius: 3px;
                    `;
                    listContainer.appendChild(itemEl);
                });

                const countEl = document.createElement('div');
                countEl.textContent = `Total: ${count}`;
                countEl.style.gridColumn = 'span 3';
                countEl.style.textAlign = 'center';
                countEl.style.fontWeight = 'bold';
                listContainer.appendChild(countEl);

                // Wrap in a parent div to allow "more" link
                const wrapper = document.createElement('div');
                wrapper.appendChild(listContainer);

                // Add more link
                const moreLink = document.createElement('a');
                moreLink.href = '#';
                moreLink.textContent = 'more...';
                moreLink.className = 'show-more-list';
                moreLink.setAttribute('data-title', 'Full List');
                moreLink.setAttribute('data-list', encodeURIComponent(JSON.stringify(list)));
                moreLink.style.cssText = `
                    display: block;
                    text-align: center;
                    margin-top: 5px;
                `;

                wrapper.appendChild(moreLink);

                return wrapper.innerHTML;
            }

            // If count exceeds threshold, show limited items with more link
            const displayList = list.slice(0, LIST_THRESHOLD);
            const listContainer = document.createElement('div');
            listContainer.style.cssText = `
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 5px;
                max-width: 300px;
                max-height: 100px;
                overflow-y: auto;
            `;

            displayList.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.textContent = item;
                itemEl.style.cssText = `
                    border: 1px solid #eee;
                    padding: 2px;
                    font-size: 0.8em;
                    word-break: break-all;
                    background-color: #f9f9f9;
                    border-radius: 3px;
                `;
                listContainer.appendChild(itemEl);
            });

            const moreLink = document.createElement('a');
            moreLink.href = '#';
            moreLink.textContent = `more... (${count} total)`;
            moreLink.className = 'show-more-list';
            moreLink.setAttribute('data-title', 'Full List');
            moreLink.setAttribute('data-list', encodeURIComponent(JSON.stringify(list)));
            moreLink.style.cssText = `
                grid-column: span 3;
                text-align: center;
                margin-top: 5px;
            `;

            listContainer.appendChild(moreLink);

            return listContainer.outerHTML;
        }

        // Rest of the existing code remains the same...
    });
</script>
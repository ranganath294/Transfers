// New function to render inner table for coverage types
function renderInnerTable_1(phaseData, parentRow) {
    // Create inner table container
    const innerTableContainer = document.createElement('tr');
    innerTableContainer.className = 'inner-table-container';
    
    const innerTableCell = document.createElement('td');
    innerTableCell.setAttribute('colspan', '12');  // Match total columns
    
    const innerTable = document.createElement('table');
    innerTable.className = 'inner-coverage-types-table';
    innerTable.style.cssText = `
        width: 98%;
        margin: 10px auto;
        border-collapse: collapse;
        background-color: #f9f9f9;
        box-shadow: 0 2px 3px rgba(0,0,0,0.1);
    `;

    // Create inner table header
    const thead = document.createElement('thead');
    const headerRow = document.createElement('tr');
    headerRow.style.backgroundColor = '#328AA4';
    headerRow.style.color = 'white';

    const headers = [
        'Coverage Type', 
        'Total TCs',
        'Coverage', 'Coverage %',
        'Passed', 'Pass %',
        'Failed', 'Fail %',
        'Blocked', 'Block %',
        'Unique CRs', 
        'Unique JIRAs'
    ];

    headers.forEach(header => {
        const th = document.createElement('th');
        th.textContent = header;
        th.style.padding = '8px';
        th.style.border = '1px solid #ddd';
        headerRow.appendChild(th);
    });

    thead.appendChild(headerRow);
    innerTable.appendChild(thead);

    // Create table body
    const tbody = document.createElement('tbody');

    // Assuming phase has coverage_types
    (phaseData.coverage_types || []).forEach(coverageType => {
        const tr = document.createElement('tr');
        
        const cells = [
            coverageType.coverage_type,
            coverageType.metrics.total,
            coverageType.metrics.coverage,
            formatPercentage(coverageType.metrics.coverage_percentage),
            coverageType.metrics.passed,
            formatPercentage(coverageType.metrics.passed_percentage),
            coverageType.metrics.failed,
            formatPercentage(coverageType.metrics.failed_percentage),
            coverageType.metrics.blocked,
            formatPercentage(coverageType.metrics.blocked_percentage)
        ];

        cells.forEach(cellData => {
            const td = document.createElement('td');
            td.textContent = cellData;
            td.style.border = '1px solid #ddd';
            td.style.padding = '6px';
            tr.appendChild(td);
        });

        // Add Unique CRs column
        const crTd = document.createElement('td');
        crTd.innerHTML = formatLongList(coverageType.unique_cr_list, coverageType.unique_cr_count);
        crTd.style.border = '1px solid #ddd';
        crTd.style.padding = '6px';
        tr.appendChild(crTd);

        // Add Unique JIRAs column
        const jiraTd = document.createElement('td');
        jiraTd.innerHTML = formatLongList(coverageType.unique_jira_list, coverageType.unique_jira_count);
        jiraTd.style.border = '1px solid #ddd';
        jiraTd.style.padding = '6px';
        tr.appendChild(jiraTd);

        tbody.appendChild(tr);
    });

    innerTable.appendChild(tbody);
    innerTableCell.appendChild(innerTable);
    innerTableContainer.appendChild(innerTableCell);

    // Insert the inner table row right after the parent row
    parentRow.insertAdjacentElement('afterend', innerTableContainer);

    return innerTableContainer;
}

// Modify renderCumulativeTable to add expand/collapse functionality
function renderCumulativeTable(data, targetElementId) {
    // ... (previous implementation remains the same)

    // Modify the phase row rendering to include expand icon
    sp.phases.forEach((phase, phaseIndex) => {
        const tr = document.createElement('tr');
        
        // Expand/Collapse column
        const expandTd = document.createElement('td');
        const expandIcon = document.createElement('span');
        expandIcon.innerHTML = '➕';  // Plus icon
        expandIcon.style.cssText = `
            cursor: pointer;
            padding: 0 5px;
            font-weight: bold;
            color: #328AA4;
        `;
        expandIcon.setAttribute('data-expanded', 'false');
        
        expandIcon.addEventListener('click', (e) => {
            const parentRow = e.target.closest('tr');
            const isExpanded = e.target.getAttribute('data-expanded') === 'true';
            
            // Remove any existing inner tables
            const existingInnerTable = parentRow.nextElementSibling;
            if (existingInnerTable && existingInnerTable.classList.contains('inner-table-container')) {
                existingInnerTable.remove();
                e.target.innerHTML = '➕';
                e.target.setAttribute('data-expanded', 'false');
                return;
            }

            // Render inner table
            renderInnerTable_1(phase, parentRow);
            e.target.innerHTML = '➖';  // Minus icon
            e.target.setAttribute('data-expanded', 'true');
        });

        expandTd.appendChild(expandIcon);
        tr.appendChild(expandTd);

        // Rest of the row rendering remains the same...
        const cells = [
            phase.phase,
            phase.metrics.total,
            // ... (other cells)
        ];

        cells.forEach(cellData => {
            const td = document.createElement('td');
            td.textContent = cellData;
            tr.appendChild(td);
        });

        // Add Unique CRs and JIRAs columns
        // ... (previous implementation)

        tbody.appendChild(tr);
    });

    // ... (rest of the implementation remains the same)
}
function formatLongList(list, count) {
    // Create a wrapper div
    const wrapper = document.createElement('div');
    wrapper.style.cssText = `
        display: flex;
        flex-direction: column;
        max-width: 300px;
    `;

    // Total count display
    const totalCountEl = document.createElement('div');
    totalCountEl.textContent = `Total: ${count}`;
    totalCountEl.style.cssText = `
        font-weight: bold;
        margin-bottom: 5px;
        text-align: left;
    `;
    wrapper.appendChild(totalCountEl);

    // List display logic remains similar to previous implementation
    if (count <= LIST_THRESHOLD) {
        const listContainer = document.createElement('div');
        listContainer.style.cssText = `
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            max-height: 100px;
            overflow-y: auto;
        `;

        list.forEach(item => {
            const itemEl = document.createElement('div');
            itemEl.textContent = item;
            itemEl.style.cssText = `
                border: 1px solid #eee;
                padding: 2px;
                font-size: 0.8em;
                word-break: break-all;
                background-color: #f9f9f9;
                border-radius: 3px;
            `;
            listContainer.appendChild(itemEl);
        });

        wrapper.appendChild(listContainer);

        // Add more link if needed
        if (count > LIST_THRESHOLD) {
            const moreLink = document.createElement('a');
            moreLink.href = '#';
            moreLink.textContent = 'more...';
            moreLink.className = 'show-more-list';
            moreLink.setAttribute('data-title', `Full List (${count} items)`);
            moreLink.setAttribute('data-list', encodeURIComponent(JSON.stringify(list)));
            moreLink.style.cssText = `
                display: block;
                text-align: center;
                margin-top: 5px;
            `;
            wrapper.appendChild(moreLink);
        }
    } else {
        const displayList = list.slice(0, LIST_THRESHOLD);
        const listContainer = document.createElement('div');
        listContainer.style.cssText = `
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            max-height: 100px;
            overflow-y: auto;
        `;

        displayList.forEach(item => {
            const itemEl = document.createElement('div');
            itemEl.textContent = item;
            itemEl.style.cssText = `
                border: 1px solid #eee;
                padding: 2px;
                font-size: 0.8em;
                word-break: break-all;
                background-color: #f9f9f9;
                border-radius: 3px;
            `;
            listContainer.appendChild(itemEl);
        });

        wrapper.appendChild(listContainer);

        // More link
        const moreLink = document.createElement('a');
        moreLink.href = '#';
        moreLink.textContent = `more... (${count} total)`;
        moreLink.className = 'show-more-list';
        moreLink.setAttribute('data-title', `Full List (${count} items)`);
        moreLink.setAttribute('data-list', encodeURIComponent(JSON.stringify(list)));
        moreLink.style.cssText = `
            display: block;
            text-align: center;
            margin-top: 5px;
        `;
        wrapper.appendChild(moreLink);
    }

    return wrapper.innerHTML;
}

function createListModal(title, list) {
    // Create modal container
    const modal = document.createElement('div');
    modal.className = 'list-modal';
    modal.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border: 1px solid #ccc;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        width: 80vw;
        max-width: 1000px;
        max-height: 70vh;
        overflow: hidden;
        z-index: 1000;
        border-radius: 8px;
    `;

    // Modified header to include total count
    const header = document.createElement('div');
    header.style.cssText = `
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        border-bottom: 1px solid #eee;
        background-color: #328AA4;
        color: white;
    `;
    
    // Create title with total count
    const titleEl = document.createElement('h3');
    titleEl.textContent = `${title} (Total: ${list.length})`;
    titleEl.style.margin = '0';

    // Close button
    const closeBtn = document.createElement('button');
    closeBtn.textContent = 'âœ•';
    closeBtn.style.cssText = `
        background: none;
        border: none;
        font-size: 20px;
        cursor: pointer;
        color: white;
    `;
    closeBtn.addEventListener('click', () => {
        document.body.removeChild(modal);
        document.body.removeChild(overlay);
    });

    header.appendChild(titleEl);
    header.appendChild(closeBtn);

    // Modal content (scrollable list)
    const content = document.createElement('div');
    content.style.cssText = `
        max-height: 50vh;
        overflow-y: auto;
        padding: 10px;
    `;

    // Create grid-like layout for list items
    const listContainer = document.createElement('div');
    listContainer.style.cssText = `
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
        padding: 10px;
    `;

    list.forEach(item => {
        const itemEl = document.createElement('div');
        itemEl.textContent = item;
        itemEl.style.cssText = `
            border: 1px solid #eee;
            padding: 5px;
            background-color: #f9f9f9;
            border-radius: 4px;
            word-break: break-all;
        `;
        listContainer.appendChild(itemEl);
    });

    content.appendChild(listContainer);

    // Overlay
    const overlay = document.createElement('div');
    overlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 999;
    `;
    overlay.addEventListener('click', () => {
        document.body.removeChild(modal);
        document.body.removeChild(overlay);
    });

    modal.appendChild(header);
    modal.appendChild(content);

    document.body.appendChild(overlay);
    document.body.appendChild(modal);
}
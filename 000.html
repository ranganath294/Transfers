function addRowHighlighting() {
    const rows = document.querySelectorAll('.phase-row');
    
    rows.forEach(row => {
        row.addEventListener('mouseenter', () => {
            // Get the current row's attributes
            const spName = row.getAttribute('data-sp-name');
            const team = row.getAttribute('data-team');
            const phase = row.getAttribute('data-phase');
            const rowIndex = parseInt(row.getAttribute('data-row-index'));
            
            // Add highlight class to the current row
            row.classList.add('highlighted-team');
            
            // Find cells for highlighting
            const allRows = Array.from(document.querySelectorAll('.phase-row'));
            const rowSpanRanges = new Map(); // To track rowspan ranges
            
            // First pass: collect rowspan ranges for SP, team, and phase cells
            allRows.forEach((r, idx) => {
                Array.from(r.cells).forEach((cell, cellIndex) => {
                    const rowSpan = parseInt(cell.rowSpan) || 1;
                    if (rowSpan > 1) {
                        if (cell.getAttribute('data-sp-cell') === 'true' ||
                            cell.getAttribute('data-team-cell') === 'true' ||
                            cellIndex === 3) { // Phase column
                            rowSpanRanges.set(cell, {
                                start: idx,
                                end: idx + rowSpan - 1,
                                type: cellIndex === 3 ? 'phase' : 
                                      cell.getAttribute('data-sp-cell') === 'true' ? 'sp' : 'team'
                            });
                        }
                    }
                });
            });
            
            // Second pass: apply highlighting based on collected ranges
            rowSpanRanges.forEach((range, cell) => {
                if (rowIndex >= range.start && rowIndex <= range.end) {
                    switch (range.type) {
                        case 'sp':
                            if (cell.textContent.trim().includes(spName)) {
                                cell.classList.add('highlighted-team');
                            }
                            break;
                        case 'team':
                            if (cell.textContent.trim() === team) {
                                cell.classList.add('highlighted-team');
                            }
                            break;
                        case 'phase':
                            if (cell.textContent.trim() === phase) {
                                cell.classList.add('highlighted-team');
                            }
                            break;
                    }
                }
            });
            
            // Highlight any non-rowspan cells in the current row
            Array.from(row.cells).forEach(cell => {
                if (!rowSpanRanges.has(cell)) {
                    cell.classList.add('highlighted-team');
                }
            });
        });
        
        row.addEventListener('mouseleave', () => {
            // Remove highlight class from all cells
            document.querySelectorAll('.highlighted-team').forEach(el => {
                el.classList.remove('highlighted-team');
            });
        });
    });
}
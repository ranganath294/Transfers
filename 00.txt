{% extends 'iot_catalogue/base.html' %}

{% block content_div %}

<form method="post" action="{% url 'iot_catalogue:search' %}" class="row g-3">
    {% csrf_token %}
    <div class="col-md-6">
        <div class="mb-3">
            <label class="form-label">Device Type</label>
            <select name="device_type" class="form-select">
                <option value="default" selected>-- All --</option>
                <option value="Headset">Headset</option>
                <option value="Speaker">Speaker</option>
                <option value="Earbud">Earbud</option>
                <option value="HID Mouse">HID Mouse</option>
                <option value="HID Keyboard">HID Keyboard</option>
                <option value="HID Gamepad">HID Gamepad</option>
                <option value="HOGP Mouse">HOGP Mouse</option>
                <option value="HOGP Keyboard">HOGP Keyboard</option>
                <option value="HOGP Gamepad">HOGP Gamepad</option>
                <option value="Carkit">Carkit</option>
                <option value="Smart Watch">Smart Watch</option>
                <option value="Fitness band">Fitness band</option>
                <option value="Heart rate monitor">Heart rate monitor</option>
                <option value="LE tracker">LE tracker</option>
                <option value="Phone">Phone</option>
                <option value="Smart ring">Smart ring</option>
                <option value="Health device">Health device</option>
                <option value="Smart bulb">Smart bulb</option>
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label">Model Number</label>
            <div class="input-group">
                <span class="input-group-text">LIKE</span>
                <input type="text" name="model_number" class="form-control">
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label">Chipset Manufacturer</label>
            <div class="input-group">
                <span class="input-group-text">LIKE</span>
                <input type="text" name="chipset_manufacturer" class="form-control">
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label">Procured Date</label>
            <div class="input-group">
                <span class="input-group-text">BETWEEN</span>
                <input type="date" name="procured_date_between" class="form-control">
                <span class="input-group-text">AND</span>
                <input type="date" name="procured_date_and" class="form-control">
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label">Availability</label>
            <select name="availability" class="form-select">
                <option value="default" selected>-- All --</option>
                <option value="Available">Available</option>
                <option value="In Use">In Use</option>
            </select>
        </div>
        
    </div>

    <div class="col-md-6">
        
        <div class="mb-3">
            <label class="form-label">Manufacturer</label>
            <div class="input-group">
                <span class="input-group-text">LIKE</span>
                <input type="text" name="manufacturer" class="form-control">
            </div>
        </div>
        
        <div class="mb-3">
            <label class="form-label">Model Year</label>
            <div class="input-group">
                <span class="input-group-text">BETWEEN</span>
                <input type="number" name="model_year_between" class="form-control">
                <span class="input-group-text">AND</span>
                <input type="number" name="model_year_and" class="form-control">
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label">Device Status</label>
            <select name="device_status" class="form-select">
                <option value="default" selected>-- All --</option>
                <option value="Active">Active</option>
                <option value="Missing">Missing</option>
                <option value="Retired">Retired</option>
                <option value="Damaged">Damaged</option>
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label">Geo Locations</label>
            <select name="geo_location" class="form-select">
                <option value="default" selected>-- All --</option>
                <option value="SD">SD</option>
                <option value="SDC">SDC</option>
                <option value="QIPL">QIPL</option>
            </select>
        </div>

        <!-- <div class="mb-3">
            <label class="form-label">Supported Technologies</label>
            <select name="supported_technologies" class="form-select">
                <option value="default" selected>-- All --</option>
                <option value="wlan">WLAN</option>
                <option value="bluetooth">Bluetooth</option>
                <option value="wlan_and_bluetooth">WLAN and Bluetooth</option>
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label">Customer Names</label>
            <div class="input-group">
                <span class="input-group-text">LIKE</span>
                <input type="text" name="customer_names" class="form-control">
            </div>
        </div>  -->
    </div>
    
    <div class="col-12 text-end">
        <button type="submit" class="btn btn-primary">
            <i class="fas fa-search me-2"></i>Search
        </button>
        <button type="reset" class="btn btn-secondary">
            <i class="fas fa-undo me-2"></i>Reset
        </button>
    </div>
</form>
{% endblock %}

{% block results_div %}
{% if devices %}
<style>
    .table-container {
        position: relative;
        max-height: calc(100vh - 300px);
        overflow: auto;
    }
    
    /* Make the header sticky */
    .table-sticky thead {
        position: sticky;
        top: 0;
        z-index: 1;
        background-color: #f8f9fa;
    }
    
    /* Custom scrollbar styling */
    .table-container::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }
    
    .table-container::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
    }
    
    .table-container::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 4px;
    }
    
    .table-container::-webkit-scrollbar-thumb:hover {
        background: #555;
    }

    /* Ensure table columns don't wrap */
    .table-sticky th,
    .table-sticky td {
        white-space: nowrap;
        padding: 0.75rem;
    }

    /* Add shadow when scrolling */
    .table-shadow {
        box-shadow: inset 0 0 5px rgba(0,0,0,0.15);
        border-radius: 0.375rem;
    }
</style>

<div class="card-body">
    <div class="table-shadow">
        <div class="table-container">
            <table class="table table-hover table-sticky mb-0">
                <thead>
                    <tr class="bg-light">
                        {% for col_name in column_names %}
                            <th class="fw-semibold">{{ col_name }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody id="results-table-body">
                    <!-- Rows will be inserted here by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<script id="devices-data" type="application/json">
    {{ devices|safe }}
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const devicesData = JSON.parse(document.getElementById('devices-data').textContent);
        const tableBody = document.getElementById('results-table-body');

        devicesData.forEach(device => {
            const row = document.createElement('tr');
            for (const key in device) {
                const cell = document.createElement('td');
                cell.textContent = device[key];
                row.appendChild(cell);
            }
            tableBody.appendChild(row);
        });
    });
</script>
{% endif %}
{% endblock %}

<!-- <tbody>
    {% for device in devices|safe %}
        <tr>
            {% for key, value in device.items %}
                <td>{{ value }}</td>
            {% endfor %}
        </tr>
    {% endfor %}
</tbody> -->

